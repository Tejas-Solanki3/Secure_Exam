<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SecureExamLite - Submission Success</title>
    <link rel="stylesheet" href="../static/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { display: flex; justify-content: center; align-items: center; min-height: 100vh; background-color: var(--light-gray-100); padding: 2rem 0; }
        .container { max-width: 600px; width: 100%; background: var(--cloud-white); border-radius: 16px; box-shadow: var(--shadow-lg); padding: 2rem; box-sizing: border-box; }
        header { text-align: center; }
        .success-icon-container { color: var(--success-green); margin-bottom: 20px; }
        .summary-section { text-align: left; margin-top: 30px; padding-top: 20px; border-top: 1px solid var(--border-light); }
        .summary-section h3 { margin-top: 0; margin-bottom: 15px; color: var(--primary-blue-dark); }
        .summary-details p { margin-bottom: 10px; color: var(--text-dark); }
        .summary-details span { font-weight: normal; color: var(--text-medium); margin-left: 10px; }
        .report-items { list-style: none; padding: 0; margin: 0; }
        .report-items li { background-color: var(--primary-blue-lightest); padding: 15px; border-radius: 8px; margin-bottom: 15px; display: flex; align-items: center; gap: 15px; }
        .report-icon { color: var(--success-green); font-size: 1.5em; }
        .report-items li .report-icon-warning { color: orange; }
        .report-details { flex-grow: 1; color: var(--text-dark); }
        .report-details .detail-value { font-weight: bold; }
        .submission-actions { margin-top: 30px; display: flex; flex-direction: column; gap: 15px; }
        .submission-actions .btn { width: 100%; box-sizing: border-box; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="success-icon-container">
                 <i class="fas fa-check-circle fa-5x"></i>
            </div>
            <h1>Exam Submitted</h1>
        </header>
        <main>
            <p style="color: var(--text-medium); font-size: 1em; text-align: center;">Your exam has been successfully submitted.</p>
            
            <div class="summary-section">
                <h3>Exam Details</h3>
                <div class="summary-details">
                    <p>Exam: <span id="summaryExamName">--</span></p>
                    <p>Submitted At: <span id="summarySubmitTime">--</span></p>
                    <p>Questions Attempted: <span id="summaryAttempted">--</span></p>
                </div>
            </div>

             <div class="summary-section">
                <h3>Proctoring Report</h3>
                 <ul class="report-items" id="proctoringReport">
                     <!-- Proctoring summary will be loaded here -->
                 </ul>
            </div>
        </main>
        <footer>
            <div class="submission-actions">
                 <a href="student_dashboard.html" class="btn btn-primary"><i class="fas fa-arrow-left"></i> Back to Dashboard</a>
                 <a href="#" class="btn btn-secondary"><i class="fas fa-chart-bar"></i> View Results</a>
                 <button class="btn btn-secondary" id="logoutBtn"><i class="fas fa-sign-out-alt"></i> Logout</button>
            </div>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const sessionId = new URLSearchParams(window.location.search).get('session_id');
            if (!sessionId) {
                document.querySelector('main').innerHTML = '<p>Error: No submission ID found.</p>';
                return;
            }

            // Update the View Results button href
            const viewResultsBtn = document.querySelector('a[href*="student_results.html"]');
            if (viewResultsBtn) {
                viewResultsBtn.href = `student_results.html?session_id=${sessionId}`;
            }

            try {
                const response = await fetch(`/api/submission/summary/${sessionId}`);
                const data = await response.json();

                if (!response.ok) throw new Error(data.message);

                document.getElementById('summaryExamName').textContent = data.summary.exam_name;
                document.getElementById('summarySubmitTime').textContent = new Date(data.summary.end_time).toLocaleString();
                document.getElementById('summaryAttempted').textContent = `${data.summary.questions_attempted} / ${data.summary.total_questions}`;

                const reportList = document.getElementById('proctoringReport');
                reportList.innerHTML = '';
                if (data.summary.warnings > 0) {
                    reportList.innerHTML += `<li><i class="fas fa-exclamation-triangle report-icon report-icon-warning"></i><span class="report-details">Suspicious activities detected: <span class="detail-value">${data.summary.warnings} times</span></span></li>`;
                } else {
                    reportList.innerHTML += `<li><i class="fas fa-check-circle report-icon"></i><span class="report-details">No suspicious activities detected</span></li>`;
                }
                reportList.innerHTML += `<li><i class="fas fa-video report-icon"></i><span class="report-details">Camera remained active throughout</span></li>`;

            } catch (error) {
                document.querySelector('main').innerHTML = `<p>Error loading submission summary: ${error.message}</p>`;
            }

            const logoutBtn = document.getElementById('logoutBtn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', async () => {
                    await fetch('/api/student/logout', { method: 'POST' });
                    localStorage.removeItem('currentStudentId');
                    window.location.href = 'homepage.html';
                });
            }
        });
    </script>
</body>
</html>
